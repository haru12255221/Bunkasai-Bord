# 要件定義書

## はじめに

この機能は、匿名ユーザーが文化祭のリアルタイム掲示板システムに投稿を作成・送信できるようにするものです。このシステムにより、ユーザーはニックネームを登録し、ライブタイムラインに表示されるテキストコンテンツを投稿することで、文化祭期間中のリアルタイムなコミュニケーションと交流を促進します。

## 要件

### 要件1

**ユーザー物語:** 文化祭の来場者として、身元を明かさずに掲示板に参加できるよう、ニックネームを匿名で登録したい。

#### 受け入れ基準

1.  ユーザーが初めてアプリを訪れた際、システムはニックネームの入力を促すこと。
2.  ユーザーがニックネームを入力した際、システムはFirebase Authを使用して匿名で認証すること。
3.  ニックネームが既に存在する場合、システムは自動的に数字を付加し（例: 「田中2」）、確認画面を表示すること。
4.  ニックネーム登録が完了した際、システムはユーザーのニックネームをFirestoreの`users`コレクションに保存すること。
5.  認証が成功した際、システムはブラウザのリフレッシュ後もユーザーのセッションを維持すること。

### 要件2

**ユーザー物語:** 認証された匿名ユーザーとして、文化祭中の考えや体験を共有できるよう、テキスト投稿を作成したい。

#### 受け入れ基準

1.  認証されたユーザーが投稿インターフェースにアクセスした際、システムはテキスト入力フォームを表示すること。
2.  ユーザーがテキストコンテンツを入力した際、システムは入力が空でないこと、および文字数制限内であることを検証すること。
3.  ユーザーが投稿を送信した際、システムは`posts`コレクションに`text`、`nickname`、`createdAt`、`categoryId`フィールドを持つ新しいドキュメントを作成すること。
4.  投稿を作成する際、システムは正確なタイムスタンプ記録のために`serverTimestamp()`を使用すること。
5.  投稿が正常に作成された際、システムは入力フォームをクリアし、成功のフィードバックを表示すること。
6.  投稿作成が失敗した場合、システムは適切なエラーメッセージを表示すること。

### 要件3

**ユーザー物語:** ユーザーとして、最新の文化祭の活動や会話を把握できるよう、投稿がリアルタイムで表示されることを望む。

#### 受け入れ基準

1.  タイムラインが読み込まれた際、システムは作成時刻順（新しいものが最初）に全ての投稿を表示すること。
2.  いずれかのユーザーによって新しい投稿が作成された際、システムはページをリフレッシュせずにタイムラインを自動的に更新すること。
3.  投稿を表示する際、システムは各投稿のニックネーム、タイムスタンプ、テキストコンテンツを表示すること。
4.  投稿の読み込み中、システムは適切なローディング状態を表示すること。
5.  投稿がない場合、システムは空の状態メッセージを表示すること。

### 要件4

**ユーザー物語:** システム管理者として、データの整合性とアクセス制御が維持されるよう、投稿がFirebase Security Rulesによって保護されることを望む。

#### 受け入れ基準

1.  いずれかのユーザーが`posts`コレクションにアクセスした際、システムは全ての認証済みユーザーに読み取りアクセスを許可すること。
2.  ユーザーが投稿を作成しようとした際、システムは認証済みユーザーのみが新しいドキュメントを書き込むことを許可すること。
3.  ユーザーが投稿を編集または削除しようとした際、システムはアクセスを拒否すること（管理者のみが変更可能）。
4.  ユーザーデータにアクセスする際、システムはユーザーが自身のユーザーデータのみを読み取れることを保証すること。
5.  投稿を検証する際、システムはセキュリティルールを通じて必須フィールド（`text`、`nickname`、`createdAt`）を強制すること。

---
# 要件定義書

## はじめに

この機能は、既存の匿名投稿システムにハッシュタグ機能を追加し、ユーザーが投稿にハッシュタグを付けて分類・検索できるようにするものです。これにより、文化祭期間中の投稿をトピック別に整理し、関連する投稿を簡単に見つけられるようになります。

## 要件

### 要件1

**ユーザー物語:** 投稿者として、自分の投稿を特定のトピックやテーマで分類できるよう、投稿にハッシュタグを追加したい。

#### 受け入れ基準

1. ユーザーが投稿フォームでテキストを入力する際、システムは「#」で始まるハッシュタグを自動的に認識すること
2. ユーザーがハッシュタグを入力する際、システムはリアルタイムでハッシュタグをハイライト表示すること
3. ユーザーが投稿を送信する際、システムは投稿テキストからハッシュタグを抽出し、別フィールドとして保存すること
4. ハッシュタグが含まれる投稿を作成する際、システムは`posts`コレクションに`hashtags`配列フィールドを追加すること
5. ハッシュタグは日本語、英語、数字を含む文字列をサポートし、スペースや特殊文字で区切られること

### 要件2

**ユーザー物語:** 閲覧者として、投稿に含まれるハッシュタグを視覚的に識別できるよう、ハッシュタグが強調表示されることを望む。

#### 受け入れ基準

1. 投稿一覧で投稿を表示する際、システムはテキスト内のハッシュタグを青色でハイライト表示すること
2. ハッシュタグを表示する際、システムはクリック可能なリンクとして表示すること
3. ユーザーがハッシュタグをクリックした際、システムは該当するハッシュタグを含む投稿のみを表示すること
4. ハッシュタグフィルター表示中、システムは現在のフィルター状態を明確に表示すること
5. フィルター表示中、システムは「すべての投稿を表示」オプションを提供すること

### 要件3

**ユーザー物語:** ユーザーとして、人気のあるトピックや話題を把握できるよう、よく使われるハッシュタグを確認したい。

#### 受け入れ基準

1. システムは投稿一覧の上部に人気ハッシュタグセクションを表示すること
2. 人気ハッシュタグを表示する際、システムは使用回数の多い順に最大10個のハッシュタグを表示すること
3. ユーザーが人気ハッシュタグをクリックした際、システムは該当するハッシュタグでフィルターされた投稿を表示すること
4. 人気ハッシュタグを表示する際、システムは各ハッシュタグの使用回数も表示すること
5. 新しい投稿が作成された際、システムは人気ハッシュタグリストをリアルタイムで更新すること

### 要件4

**ユーザー物語:** ユーザーとして、特定のハッシュタグに関連する投稿を効率的に見つけられるよう、ハッシュタグ検索機能を使いたい。

#### 受け入れ基準

1. システムは投稿一覧の上部にハッシュタグ検索フィールドを表示すること
2. ユーザーがハッシュタグを検索する際、システムは部分一致でハッシュタグを提案すること
3. ユーザーが検索を実行した際、システムは該当するハッシュタグを含む投稿のみを表示すること
4. 検索結果を表示する際、システムは検索されたハッシュタグをハイライト表示すること
5. 検索がアクティブな際、システムは検索をクリアするオプションを提供すること

### 要件5

**ユーザー物語:** システム管理者として、ハッシュタグデータの整合性が保たれるよう、適切なデータ検証とセキュリティルールが適用されることを望む。

#### 受け入れ基準

1. 投稿を作成する際、システムはハッシュタグ配列の各要素が文字列であることを検証すること
2. ハッシュタグを保存する際、システムは重複を除去し、小文字に正規化すること
3. Firebase Security Rulesで、システムは`hashtags`フィールドの読み取りを全認証ユーザーに許可すること
4. ハッシュタグを含む投稿を作成する際、システムは既存のセキュリティルールと整合性を保つこと
5. ハッシュタグの長さは最大50文字、1投稿あたり最大10個のハッシュタグに制限すること